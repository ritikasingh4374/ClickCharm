{% extends 'shop/basic.html' %}

{% block css %}
        body{
            background-color : aquariousBlue;
        }
        .col-md-3 {
            display: inline-block;
            margin-left: -4px;
        }

        .col-md-3 {
            width: 100%;
            height: auto;
        }

        .col-md-3 img{
          max-width: 280px;
          height: 240px;
          padding : 10px;
         }

         #cart-dropdown {
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        #cart-items p {
            margin: 0;
        }
        



        body .no-padding {
            padding-left: 0;
            padding-right: 0;
        }

        .carousel-control-prev-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3e%3c/svg%3e");
            
          
        }

        .carousel-control-next-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3e%3c/svg%3e");
        }

        .carousel-control-prev, 
        .carousel-control-next{
          top : auto;
            bottom : auto;
            padding-top : 220px;
        }
        body .carousel-indicators{
        bottom:0;
        }

        .carousel-indicators .active{
        background-color: blue;
        }


    {% endblock %}
{% block body %}
{% load static %}



<!--        carousel indicators starts from here-->

<div class="container">
  {%for product , range, nslides in allprods %}
  <h3 class="my-4"> Flash Sale on {{product.0.category}} : Reccomended items</h3>
  <div class ="row">
    <div id="demo{{forloop.counter}}" class="col carousel slide my-3" data-ride="carousel">'
        <ul class="carousel-indicators">
            <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>
    {% for i in range %}
       <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{i}}" ></li>
    {% endfor %}
</ul>

<!--        slideshow starts here-->

      <div class="carousel-inner">
        <div class="carousel-item active">
          

            {% for i in product %}
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card" style="width: 13rem;">
                <img src='/media/{{i.image}}' class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">{{i.product_name}}</h5>
                  <p class="card-text">{{i.desc|slice:"0:53"}}...</p>
            
                  <!-- "Add to Cart" button -->
                  <button class="add-to-cart btn btn-primary" id="add-to-cart-{{i.id}}">Add to Cart</button>
                   
                  <!-- Plus Minus Button Section (Initially hidden) -->
                  <div class="quantity-controls" id="quantity-controls-{{i.id}}" style="display: none;">
                    <button class="minus btn btn-danger" id="minus-{{i.id}}">-</button>
                    <span class="quantity" id="quantity-{{i.id}}">1</span>
                    <button class="plus btn btn-success" id="plus-{{i.id}}">+</button>
                  </div>
            
                  <a href="/shop/products/{{i.id}}"><button class="btn btn-primary">Quick View</button></a>
                  
                </div>
                
              </div>
            </div>
            

            {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
             </div><div class="carousel-item">
            {% endif %}

            {% endfor %}
      </div>

      </div>
        </div>

<a class="carousel-control-prev " href="#demo{{forloop.counter}}" role="button" data-slide="prev">
   <span class="carousel-control-prev-icon" aria-hidden="true" ></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="carousel-control-next" href="#demo{{forloop.counter}}" role="button" data-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>
    </div>
  {% endfor %}
</div>
 {% endblock %}

 {% block js %}
<script>
console.log('working');
if(localStorage.getItem('cart') == null){
var cart = {};
localStorage.setItem('cart', JSON.stringify(cart));
}
else
{
cart = JSON.parse(localStorage.getItem('cart'));
document.getElementById('cart').innerHTML = Object.keys(cart).length;
}

$(document).ready(function() {
    // Function to initialize the cart from localStorage
    function initializeCart() {
        var cart = JSON.parse(localStorage.getItem('cart')) || {};

        // Update the cart display based on the cart object
        updateCartDisplay(cart);

        // Show or hide buttons and quantity controls based on cart state
        for (var id in cart) {
            $('#quantity-' + id).html(cart[id]);
            $('#add-to-cart-' + id).hide(); // Hide the "Add to Cart" button for items already in cart
            $('#quantity-controls-' + id).show(); // Show plus-minus controls for items already in cart
        }
    }
    //function to clear cart
    function clearCart(){
        cart = JSON.parse(localStorage.getItem('cart'));
        for(var item in cart) {
            document.getElementById('div' + item).innerHTML = ' <button class="add-to-cart btn btn-primary" id="'+ item +'">Add to Cart</button>';
        }
        localStorage.clear();
        cart = {};
        updateCart(cart);
    }

    // Function to update cart display
    function updateCartDisplay(cart) {
        var totalItems = 0;
        for (var key in cart) {
            totalItems += cart[key]; // Sum up all quantities
        }

        // Update the cart count in the header
        var cartElement = document.getElementById('cart');
        if (cartElement) {
            cartElement.innerHTML = totalItems;
        }
    }

    // Event listener for the "Add to Cart" button
    $('.add-to-cart').click(function() {
        var idstr = this.id.split('-')[3]; // Extract product ID from the button's ID
        console.log('Add to cart clicked for product ID: ' + idstr);

        // Initialize or increment the quantity in the cart
        var cart = JSON.parse(localStorage.getItem('cart')) || {};
        if (cart[idstr] != undefined) {
            cart[idstr] += 1;
        } else {
            cart[idstr] = 1;
        }

        // Update localStorage and UI
        localStorage.setItem('cart', JSON.stringify(cart));
        $('#add-to-cart-' + idstr).hide();
        $('#quantity-controls-' + idstr).show();
        updateCartDisplay(cart);
    });

    // Event listener for the plus (+) button
    $('.plus').click(function() {
        var idstr = this.id.split('-')[1]; // Get product ID from button's ID
        console.log('Plus clicked for product ID: ' + idstr);

        var cart = JSON.parse(localStorage.getItem('cart')) || {};
        if (cart[idstr] != undefined) {
            cart[idstr] += 1;
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        $('#quantity-' + idstr).html(cart[idstr]);
        updateCartDisplay(cart);
    });

    // Event listener for the minus (-) button
    $('.minus').click(function() {
        var idstr = this.id.split('-')[1]; // Get product ID from button's ID
        console.log('Minus clicked for product ID: ' + idstr);

        var cart = JSON.parse(localStorage.getItem('cart')) || {};
        if (cart[idstr] != undefined && cart[idstr] > 0) {
            cart[idstr] -= 1;
        }

        if (cart[idstr] == 0) {
            delete cart[idstr];
            $('#add-to-cart-' + idstr).show();  // Show the "Add to Cart" button
            $('#quantity-controls-' + idstr).hide();  // Hide the plus-minus controls
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        $('#quantity-' + idstr).html(cart[idstr] != undefined ? cart[idstr] : 0);
        updateCartDisplay(cart);
    });

    // Function to reset the UI when localStorage is cleared
    function clearCartUI() {
        // Hide all plus-minus buttons and reset quantities
        $('.quantity-controls').hide();  // Hide plus-minus controls for all products
        $('.add-to-cart').show();        // Show "Add to Cart" buttons again

        // Reset the displayed quantity for all products
        $('.quantity').html(1);

        // Reset the cart count in the header
        var cartElement = document.getElementById('cart');
        if (cartElement) {
            cartElement.innerHTML = 0;  // Reset cart count to 0
        }
    }

    // Clear cart when localStorage.clear() is called manually
    var originalClear = localStorage.clear;
    localStorage.clear = function() {
        originalClear.apply(this, arguments); // Call original localStorage.clear
        clearCartUI(); // Reset UI after clearing localStorage
    };

    // Initialize cart on page load
    initializeCart();
});




</script>
{% endblock %}

 

